---
title: "Data Project NHANES 2025"
author: Yanhang Qiu
output: html_document
---

1.  Familiarize yourself with the NHANES study design and the variables in the dataset by reading the sections "About the NHANES study" and "The data set" of this document. Use the information provided to answer the following questions:

<!-- -->

a)  What are important characteristics of the NHANES study (study design, target population, study objectives, study period, ...)?

**Answer to 1a:**

-   Study design: cross-sectional study - target population: recident non-institutionalized US population (adults and childern)

-   Study objectives: to determine the prevalence of major diseases and risk factors, to design health promotion campaigns, and to establish national reference values (e.g. for height, weight, blood pressure).

-   Study period: This is an ongoing study with data released in bianual cycles.

-   Sampling methods: A four-stage stratified probability cluster sample.

b\. What general categories (such as "demographics", "lab results") can the variables in the dataset be sorted into?

**Answer to 1b:**

The variables in the dataset can be categorized into five main groups: demographic data, examination data, laboratory data, dietary data, and questionnaire data.

```{r 1b, message=FALSE, warning=FALSE}

data <- read.csv2("../data/NHANES1.csv",row.names = 1)
data_raw <- data

categories <- list(
  demographic_data = c("seqn","age","educ","martlst","male","ethnic","increl","age.cat","age_bin"),
  examination_data  = c("weight","height","bmi","rr_sys","rr_dia","bmi_cat"),
  dietary_data = c("rdyfood_prvmo","frzfood_prvmo","milk_month"),
  laboratory_data = c("cd","pb","hg","hdl","logHdl","hivpos")
)

categories$questionnaire_data <- setdiff(names(data), unlist(categories))
cat_df <- stack(categories)
names(cat_df) <- c("variable", "category")

summary_table <- data.frame(
  variable = names(data),                 
  type = sapply(data, class),
  missing = colSums(is.na(data)),
  stringsAsFactors = FALSE
)

summary_table <- merge(summary_table, cat_df, by = "variable", all.x = TRUE)

summary_table [1:5,]


```

2\. Using the subsample you have chosen, describe the US population with regards to:

a\. Demographic characteristics. How can the strange age distribution be explained? To deal with this problem, recode the age variable into the following categories:18-34, 35-49, 50-64, 65-79, 80 or higher.

```{r 2a, message=FALSE, warning=FALSE}
library(ggplot2) 

plot_age <- ggplot(data, aes(x = age)) +
  geom_histogram(fill = "pink", color = "white",bins = 30) +
  labs(title = "age",x = "Age",y = "Count") +
  theme_minimal()
```

```{r 2a, message=FALSE, warning=FALSE}
library(dplyr)
data <- data %>%
  mutate(
    age_group = case_when(
      age < 18 ~ "0-17",
      age >= 18 & age < 35 ~ "18-34",
      age >= 35 & age < 50 ~ "35-49",
      age >= 50 & age < 65 ~ "50-64",
      age >= 65 & age < 80 ~ "65-79",
      age >= 80 ~ "80+"
    )
  )
```

```{r 2a, message=FALSE, warning=FALSE}
plot_age_cate <-ggplot(data, aes(x=factor(age_group))) + geom_bar(fill = "pink") + 
  labs(title = "age_group", x = "Age Group", y = "Count") +
  theme_minimal()


library(patchwork)
(plot_age | plot_age_cate) 
```

**Answer to 2a:**

The age distribution in the sample shows limited representativeness of the U.S. population, displaying an approximately uniform count across all age intervals. Despite the complex four-stage sampling design, potential biases may still arise — for example, due to substantial differences in age composition across districts, or because older participants tend to be less willing to respond compared to younger individuals. By grouping participants into age categories, we can reweight each group so that the overall age distribution in the sample better reflects that of the U.S. population.

b\. When asked about Marital status, some of the participants refused to answer while some didn't know which category they belonged. Hence they were coded differently. Take that into account and recode the variable martlst.

```{r 2b, message=FALSE, warning=FALSE}

data <- data %>%
  mutate(
    martlst_clean = na_if(martlst, 77),
    martlst_clean = na_if(martlst_clean, 99)
  )

table(data$martlst)
table(data$martlst_clean, useNA = "ifany")

```

**Answer to 2b:**

Before recoding martlst the requency of 77 and 99 are 267 and 1 respectively.After recoding the missing value into NA, there are 268 NAs in total.


c\. Self-rated health. Looking at the results of your descriptive analysis, what do you have to consider when interpreting the results?

```{r 2c1, message=FALSE, warning=FALSE}

library(ggplot2)
library(scales)

p1 <- ggplot(data, aes(x = factor(srhgnrl), y = after_stat(prop), group = 1)) +
  geom_bar(aes(y = after_stat(prop)), fill = "lightblue") +
  scale_y_continuous(labels = percent_format()) +
  labs(title = "srhgnrl")

p1

```

**Answer to 2c:**

According to the bar chart, most participants reported their general health as “good,” “very good,” or “excellent,” suggesting an overall positive perception of health in this sample. However, a considerable proportion of responses for the self-rated health item was missing (over 10%). Such missingness may be systematic rather than random, potentially resulting from factors such as privacy concerns, social desirability bias, or poor physical and mental health conditions that prevent individuals from completing self-rating questions.

To examine this potential bias, we hypothesized that the missingness pattern differs across age, gender, income and used chi-square analyses to test whether missingness in the self-rated health was systematically associated with these characteristics.

```{r 2c2, message=FALSE, warning=FALSE}

library(dplyr)
library(broom)

self_health <- data %>%
  select(age_group, male, increl, srhgnrl) %>%
  mutate(
    missing_self = as.integer(is.na(srhgnrl))
  )

by_gender <- self_health %>%
  group_by(male) %>%
  summarise(n = n(),
            n_missing = sum(missing_self),
            pct_missing = round(100 * n_missing / n, 1),
            .groups = "drop")

by_age <- self_health %>%
  group_by(age_group) %>%
  summarise(n = n(),
            n_missing = sum(missing_self),
            pct_missing = round(100 * n_missing / n, 1),
            .groups = "drop")

by_increl <- self_health %>%
  group_by(increl) %>%
  summarise(n = n(),
            n_missing = sum(missing_self),
            pct_missing = round(100 * n_missing / n, 1),
            .groups = "drop")

by_gender; by_age; by_increl


chisq_gender <- chisq.test(table(self_health$male,       self_health$missing_self))
chisq_age    <- chisq.test(table(self_health$age_group,  self_health$missing_self))
chisq_increl <- self_health %>%
  filter(!is.na(increl)) %>%
  with(chisq.test(table(increl, missing_self)))

chisq_gender
chisq_age
chisq_increl


```

**Answer to 2c (continue) :**

Chi-square tests were conducted to examine whether missingness in the self-rated health variable was randomly distributed across demographic and socioeconomic characteristics. The results indicate that missing self-rated health information was significantly associated with sex (χ² = 13.52, p \< 0.001), age group (χ² = 40.49, p \< 0.001), and family income relative to the poverty line (χ² = 23.96, p \< 0.001).

These findings suggest that missingness in the self-rated health variable is systematic rather than random. In particular, participants who are male, older, or have lower family income were more likely to have missing responses. As a result, complete-case analyses may disproportionately exclude individuals with potentially poorer health and socioeconomic disadvantage, leading to an overestimation of overall health status in the analytic sample. Therefore, the missing data mechanism is unlikely to be Missing Completely at Random (MCAR), and appropriate methods such as multiple imputation or inverse probability weighting should be considered to reduce selection bias.

3.Diabetes and ethnicity

a\. How is the diabetes status distributed in your data set? Summarize the 2 diabetes groups in a single group and recode the variable for diabetes status into two groups: non-diabetes and diabetes. Give an interval estimate for diabetes in your data set.

```{r 3a, message=FALSE, warning=FALSE}

library(dplyr)

table(data$diab_lft, useNA = "ifany")
table(data$diab_lft)
barplot(table(data$diab_lft))

data <- data %>%
  mutate(
    diabetes_status = case_when(
      diab_lft == 1 ~ "non_diabetes",
      diab_lft == 2 | diab_lft == 3 ~ "diabetes",
      TRUE ~ NA_character_
    )
  )

table(data$diabetes_status, useNA = "ifany")
barplot( table(data$diabetes_status))

library(broom)

x <- sum(data$diabetes_status == "diabetes", na.rm = TRUE)
n <- sum(!is.na(data$diabetes_status))

CI_CP<- binom.test(x, n, conf.level = 0.95) # method 1: Clopper-Pearson
tidy(CI_CP)

install.packages("binom")
library(binom)

binom.confint(x,n, conf.level = 0.95, methods = "wilson") # method 2: Wilson



```

**Answer to 3a :**

The vast majority of participants fall into category 1, indicating that most individuals are non-diabetic. A smaller fraction (category 3) are diabetic, and very few are prediabetic (category 2).

Based on our data, the estimated proportion of individuals with diabetes is about 12.8%. The CI are consistent using two methods : Wilson and Clopper-Pearson methods. The 95% confidence interval ranges approximately from 11.9% to 13.8 in both methods, meaning that if you repeated this sampling many times, 95% of such intervals would contain the true population proportion of diabetes.

However, diabetes status was missing for 308 individuals. Since the analysis excluded these cases, the estimated prevalence and confidence interval reflect only the observed sample and may not fully represent the entire study population.



b\. Work with the recoded variable. Use an appropriate statistical test to test the relation between diabetes status and ethnicity. Interpret the results of the test.

```{r}

data$diabetes_status <- factor(data$diabetes_status)
data$ethnic <- factor(data$ethnic)

tab <- table(data$diabetes_status, data$ethnic)
tab

chisq.test(tab)

```

```{r}
library(dplyr)

data <- data %>%
  mutate(
    diabetes_missing = ifelse(is.na(diabetes_status), "Missing", "Observed"),
    ethnic = factor(ethnic)
  )


tab_miss <- table(data$diabetes_missing, data$ethnic)
tab_miss

chisq.test(tab_miss)

```

**Answer to 3b :**

As diabetes_status is binomial variable and ethnicity is a nominal variable, we use chi-square test to exam their relationship. Results show that there is significant association (p = 7.296e-08 \<0.05) between diabetes status and ethinicty.

The chi-square test examining the association between diabetes status missingness and ethnicity yielded a non-significant result (χ²(3) = 1.05, p = 0.79). Therefore, the missing data on diabetes status are likely to be missing at random with respect to ethnicity, and excluding these missing cases from the analysis is unlikely to bias the estimated association between diabetes status and ethnicity.


4\. Weekly working hours and self-evaluated health status

a\. The variable `hrsworked_prvwk` codes the number of weekly working hours. 77777 or 99999 are missing values. Recode these missing values with a proper value, e.g. NA.

```{r message=FALSE, warning=FALSE}

data <- data %>%
  mutate(
    hrsworked_prvwk_clean = na_if(hrsworked_prvwk, 77777),
    hrsworked_prvwk_clean = na_if(hrsworked_prvwk_clean, 99999)
  )

sum(is.na(data$hrsworked_prvwk_clean))        # 缺失数量
mean(is.na(data$hrsworked_prvwk_clean)) * 100 # 缺失比例（百分比）


data$missing_hrs <- ifelse(is.na(data$hrsworked_prvwk_clean), "Missing", "Observed")
data$missing_srh <- ifelse(is.na(data$srhgnrl), "Missing", "Observed")

tab <- table(data$missing_hrs, data$missing_srh)
tab
chisq.test(tab)

```

**Answer to 4a :**

In variable `hrsworked_prvwk` there are 2 77777, 1 99999 and 2474 NA values. After recoding 77777 and 99999 to NA, there are 2477 missing values in total.

Although the missingness of weekly working hours and self-rated health appeared to be random (χ² = 0.71, p = 0.399), the proportion of missing data for weekly working hours was very high (49.54%).

To minimize potential information loss and improve the robustness of the analyses, multiple imputation was performed.After multiple imputation, the newly created dataset contained no missing values (number of missing values = 0). In the following analyses, both the original (non-imputed) and imputed datasets were retained and analyzed in parallel for comparison.

```{r}
library(mice)


vars <- c("srhgnrl", "hrsworked_prvwk_clean", "age", "male", "bmi")
imp_data <- data[, vars]

pred <- make.predictorMatrix(imp_data)

pred["hrsworked_prvwk_clean", "srhgnrl"] <- 0  
pred["srhgnrl", "hrsworked_prvwk_clean"] <- 0  

pred[c("srhgnrl", "hrsworked_prvwk_clean"), c("srhgnrl", "hrsworked_prvwk_clean")]

imp <- mice(imp_data, m = 5, method = "pmm", predictorMatrix = pred, seed = 123)

completed1 <- complete(imp, 1)
head(completed1)

colSums(is.na(completed1))

imp_long <- complete(imp, "long", include = FALSE)
head(imp_long)

```


b\. Recode the variable `hrsworked_prvwk` into categories [,40), [40,) weekly working hours. Number or name the categories properly. (Hint: Set the new variable as a factor variable, if necessary)

```{r 4b message=FALSE, warning=FALSE}

library(dplyr)

data <- data %>%
  mutate(
    hrsworked_prvwk_cat = case_when(
      is.na(hrsworked_prvwk_clean) ~ NA_character_,   
      hrsworked_prvwk_clean < 40 ~ "< 40",
      hrsworked_prvwk_clean >= 40 ~ ">= 40"
    )
  )

table(data$hrsworked_prvwk_cat,useNA = "ifany")



completed1 <- complete(imp, 1)

completed1 <- completed1 %>%
  mutate(
    hrs_cat = cut(hrsworked_prvwk_clean,
                  breaks = c(0, 40, Inf),
                  labels = c("<40", "≥40"),
                  right = FALSE)
  )

table(completed1$hrs_cat,useNA = "ifany")

```

**Answer to 4b :**

Before multiple imputation, there are 846 people working less than 40 hours previous week, 1677 people working more than 40 hours previous week, and still, there are 2477 missing values.

After multiple imputation and subsequent categorization, there were 1,743 individuals working less than 40 hours in the previous week and 3,257 individuals working 40 hours or more. No missing values remained in the imputed dataset.


c\. Plot weekly working hours against self-evaluated health status using mosaic plot. Looking at the plot, what would you tell about the relation between these two variables.


```{r 4c message=FALSE, warning=FALSE }

mosaicplot(table(data$srhgnrl, data$hrsworked_prvwk_cat), color = TRUE, main = "Mosaic plot: self-rated health vs weekly working hours (with missing values)") 


mosaicplot(table(completed1$srhgnrl, completed1$hrs_cat),
           color = TRUE,
           main = "Mosaic plot: self-rated health vs weekly working hours (imputed data)")

```
**Answer to 4c :** According to the mosaic plot, the distribution of self-rated health levels is similar across the two working-hour groups (\< 40 vs. ≥ 40 hours). Visually, there is no substantial difference between the plots before and after multiple imputation.



d\. Use an appropriate statistical test to test for the statistical significance of this relation. Interpret the results of the test.

```{r 4d message=FALSE, warning=FALSE }

d1 <- subset(data, !is.na(srhgnrl) & !is.na(hrsworked_prvwk_cat))
tab1 <- table(d1$srhgnrl, d1$hrsworked_prvwk_cat)
chisq.test(tab1)

tab2 <- table(completed1$srhgnrl, completed1$hrs_cat)
chisq.test(tab2)



d3 <- subset(data, !is.na(srhgnrl) & !is.na(hrsworked_prvwk_clean))
cor.test(d2$hrsworked_prvwk_clean, d2$srhgnrl,
         method = "spearman", exact = FALSE)

d4 <-cor.test(completed1$hrsworked_prvwk_clean, 
         as.numeric(as.character(completed1$srhgnrl)), 
         method = "spearman", 
         exact = FALSE)


d3;d4

```


**Answer to 4b :**

Due to concerns about the large amount of missing data, both weekly working hours and self-rated health were imputed.
Before imputation, no significant association was observed (χ² = 3.25, p = 0.52; ρ = –0.038, p = 0.082).

After imputation, the results remained non-significant (χ² = 8.28, p = 0.082; ρ = –0.008, p = 0.59).
Although the significance levels slightly differed before and after imputation, both analyses consistently indicated no significant relationship between the two variables.

Therefore, the influence of missing data on the overall conclusion appears minimal, and the association between weekly working hours and self-rated health remains statistically non-significant.




5\. Blood mercury level (umol/L) and gender

a\. Describe and plot the distribution of blood mercury level in men and women.

```{r 5a message=FALSE, warning=FALSE  }


hg_by_male <- data %>%
  group_by(male) %>%
  summarise(
    mean_hg = mean(hg, na.rm = TRUE),
    sd_hg   = sd(hg, na.rm = TRUE),
    min_hg  = min(hg, na.rm = TRUE),
    max_hg  = max(hg, na.rm = TRUE),
    p25_hg  = quantile(hg, 0.25, na.rm = TRUE),
    p50_hg = median(hg, na.rm = TRUE),
    p75_hg  = quantile(hg, 0.75, na.rm = TRUE),
    n       = sum(!is.na(hg)),
    n_missing = sum(is.na(hg)),
  )

hg_by_male %>%
  mutate(across(where(is.numeric), ~ round(.x, 2)))

hist(data$hg, col = 2, breaks = 80)
```

**Answer to 5a:**

Through descriptive analysis, we observed that blood mercury levels among participants varied widely, ranging from approximately 0.5 to more than 200 µg/L. The distribution of blood mercury levels was skewed toward the lower range, with 75% of men below 9.8 µg/L and 75% of women below 9.1 µg/L, suggesting that most participants had comparatively low exposure. However, a considerable number of individuals were still exposed to elevated blood mercury levels, posing potential health risks that warrant further investigation. In this case, we categorized the blood mercury variable into clinically meaningful risk groups based on internationally recognized guidelines from WHO, CDC, ATSDR, and EPA. This categorization provides a clearer interpretation of exposure severity and allows for more informative and interpretable visualizations.

```{r 5a message=FALSE, warning=FALSE}
library(dplyr)

data <- data %>%
  mutate(
    hg_risk_group = case_when(
      hg < 5                        ~ "<5 µg/L (Background level)",
      hg >= 5  & hg < 15            ~ "5–15 µg/L (Mild elevation)",
      hg >= 15 & hg < 50            ~ "15–50 µg/L (Moderate elevation)",
      hg >= 50 & hg < 100           ~ "50–100 µg/L (High exposure)",
      hg >= 100                     ~ "≥100 µg/L (Potential toxicity)",
      TRUE                          ~ NA_character_
    ),
    hg_risk_group = factor(
      hg_risk_group,
      levels = c(
        "<5 µg/L (Background level)",
        "5–15 µg/L (Mild elevation)",
        "15–50 µg/L (Moderate elevation)",
        "50–100 µg/L (High exposure)",
        "≥100 µg/L (Potential toxicity)"
      ),
      ordered = TRUE
    )
  )

library(dplyr)

n_total <- nrow(data)
n_valid <- sum(!is.na(data$hg_risk_group))

risk_summary <- data %>%
  mutate(group = ifelse(is.na(hg_risk_group), "Missing", as.character(hg_risk_group))) %>%
  count(group, name = "n") %>%
  mutate(
    pct_including_missing = round(n / n_total * 100, 1),   
    pct_excluding_missing = round(ifelse(group == "Missing", NA, n / n_valid * 100), 1) 
  ) %>%

  mutate(group = factor(group,
                        levels = c("<5 µg/L (Background level)",
                                   "5–15 µg/L (Mild elevation)",
                                   "15–50 µg/L (Moderate elevation)",
                                   "50–100 µg/L (High exposure)",
                                   "≥100 µg/L (Potential toxicity)",
                                   "Missing"),
                        ordered = TRUE)) %>%
  arrange(group)

risk_summary


library(ggplot2)
ggplot(
  data %>% filter(!is.na(hg_risk_group)),
  aes(x = hg_risk_group)
) +
  geom_bar(fill = "grey20") +
  labs(
    x = "Blood Mercury Level Category",
    y = "Number of Participants",
    title = "Distribution of Blood Mercury Risk Levels (Missing Excluded)"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 25, hjust = 1))



```

**Answer to 5a (continued) :**

The bar chart illustrates the distribution of blood mercury levels after excluding missing observations. The majority of participants (approximately 55.8%) fall within the background exposure range (\<5 µg/L). Notably, 72 individuals (approximately 1.7%) exhibited blood mercury concentrations exceeding 50 µg/L, placing them in the high-exposure or potentially toxic risk category.

b\. Use both parametric and non-parametric statistical tests to test for the statistical significance the relation between blood mercury level and gender. Interpret the results of the tests.

**Answer to 5b :**

Hg is a continuous variable, while male is a binary variable. Normally, when blood mercury levels follow a normal distribution, a parametric test — the independent samples t-test — is appropriate to examine whether blood mercury levels differ between males and females. When the assumption of normality is violated, the non-parametric Mann–Whitney test should be used instead.

The test of normality indicated that Hg was not normally distributed in either group. By comparing the histograms, we observed that both distributions were similarly and heavily right-skewed, which was further supported by the skewness statistics. However, given the very large sample size (over 2,000 observations per group), the t-test remains relatively robust to this deviation from normality. The F-test for homogeneity of variances revealed unequal variances between the two groups. Considering all these factors, the Welch’s t-test (which adjusts for unequal variances) or the Mann–Whitney test would be appropriate choices.

```{r}

shapiro.test(data$hg[data$male == 1])
shapiro.test(data$hg[data$male == 0])

hist(data$hg[data$male == 1],
     main = "hg - male",
     xlab = "hg",
     col = "lightblue",
     breaks = 30)

hist(data$hg[data$male == 0],
     main = "hg - female",
     xlab = "hg",
     col = "pink",
     breaks = 30)

library(e1071)
skewness(data$hg[data$male == 1], na.rm = TRUE)
skewness(data$hg[data$male == 0], na.rm = TRUE)


var.test(hg ~ male, data = data)

t.test(hg ~ male, data = data, var.equal = FALSE,conf.level = 0.99)
wilcox.test(hg ~ male, data = data, conf.level = 0.99,conf.int = TRUE)



sum(is.na(data$hg))

```

**Answer to 5b (continued) :**

Both Welch’s t-test (p = 0.0558) and the Mann–Whitney test (p = 0.7813) consistently indicate that the evidence is not strong enough to reject the null hypothesis at the 95% confidence level.

Therefore, there is no statistically significant difference in blood mercury levels between men and women.


6.BMI and HDL

a\. How strong is the relationship between BMI and HDL (the "good" cholesterol)? Is it significant? How much of the variation in HDL can be explained (in a statistical sense) by variation in BMI?

```{r}

model <- lm(hdl ~ bmi, data = data)
summary(model)

```

**Answer to 6a :**

The linear regression model showed a statistically significant negative association between BMI and HDL cholesterol (β = –0.015, p \< 0.001).

However, the explanatory power of the model was limited: only 7.7% variation (R² = 0.077) in HDL can be explained by variation in BMI, indicating that BMI alone accounts for only a small proportion of the variability in HDL, and other factors, e.g., age, likely play major roles.

Since this was a simple (single-variable) regression, the adjusted R² was nearly identical to the unadjusted R² and therefore not further discussed.


b\. Does the relationship between HDL and BMI change when you adjust for age (categorized)? Interpret the coefficients of the resulting model (when you mean-center BMI before fitting the model, you can also interpret the intercept). Would you say that BMI has a clinically relevant impact on HDL, according to your model?


```{r}

model_controlled <- lm(hdl ~ bmi + age, data = data)
summary(model_controlled)

```
**Answer to 6b :**

After adding age as a control variable, R-squared improved from 0.07721 to 0.08615, and the adjusted R-squared showed a similar patter (from 0.077 to 0.0857), indicating a modest but genuine improvement in explanatory power. BMI remained a statistically negative predictor of HDL, and its coefficient become marginally stronger, suggesting that controlling for age reduced confounding and revealed a more robust independent association between BMI and HDL.


```{r}

# 查看缺失数量
sum(is.na(data$hdl))
sum(is.na(data$bmi))
sum(is.na(data$age))
sum(!complete.cases(data[, c("hdl", "bmi", "age")]))


hdl_missing_n <- sum(is.na(data$hdl))
bmi_missing_n <- sum(is.na(data$bmi))
age_missing_n <- sum(is.na(data$age))

hdl_missing_p <- round(mean(is.na(data$hdl)) * 100, 1)
bmi_missing_p <- round(mean(is.na(data$bmi)) * 100, 1)
age_missing_p <- round(mean(is.na(data$age)) * 100, 1)

data.frame(
  Variable = c("hdl", "bmi", "age"),
  Missing_N = c(hdl_missing_n, bmi_missing_n, age_missing_n),
  Missing_Percent = c(hdl_missing_p, bmi_missing_p, age_missing_p)
)

data$missing_hdl <- ifelse(is.na(data$hdl), 1, 0)
data$missing_bmi <- ifelse(is.na(data$bmi), 1, 0)


t.test(age ~ missing_hdl, data = data)
t.test(age ~ missing_bmi, data = data)

```
**Answer to 6a and 6b (continued) :**

In the current analysis, 634 observations were excluded due to missing data. 

Both BMI and HDL had a considerable amount of missingness (574 and 290 cases, corresponding to 11.5% and 5.8%, respectively), whereas age was complete.

Correlation analyses revealed that missingness in both HDL and BMI was significantly associated with age.Specifically, the mean age was 50.0 years in the HDL-missing group versus 47.2 years in the non-missing group (t = -3.18, p = 0.0015), and 52.6 years versus 47.2 years for BMI (t = -4.32, p < 0.001). These findings suggest that the missingness mechanism was not completely at random (approximately MAR).

However, given that the overall proportion of missing data was moderate (below 15%), multiple imputation was not applied.

As older individuals generally have higher BMI and lower HDL levels, this missingness pattern likely resulted in a slightly younger and healthier analytic sample.

Consequently, the observed negative association between BMI and HDL may be somewhat attenuated, indicating that the true inverse relationship in the overall population is likely stronger than what was estimated here.



c\. Try to find a better model to predict HDL by including more covariates. Select a number of candidate covariates which in your opinion may be related to HDL, and then choose a model selection strategy and a criterion/test for comparing models. Describe the model with the best fit according to your search, and interpret the model coefficients.





7.Cancer

a\. Estimate the lifetime prevalence of cancer. Can you also give an interval estimate?

b\. What are the prevalence estimates in those who were exposed to pollutants at work for a longer time period, and in those who weren’t? Is there a significant difference in prevalence between these two subgroups?

c\. Adjust for age in the relationship between lifetime diagnosis of cancer and exposure to pollutants, using the categorized age variable (Note: No information on pollutant exposure was collected from participants aged 80+, so these cannot be included in the analysis). Does the adjustment for age change the picture? Interpret the model coefficients including the intercept.

d.Try to find a good model of cancer diagnosis, describe, and interpret it, as you did for HDL.
